<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <title>Chat do Bob</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
</head>
<body>
    <h1>Chat do Bob</h1>
    <div class="chat-container">
        <div id="chat">
            {% for msg in messages %}
                <div class="message"><strong>{{ msg.sender }}:</strong> {{ msg.text }}</div>
            {% endfor %}
        </div>
        <div class="input-row">
            <input type="text" id="message" placeholder="Digite sua mensagem">
            <button onclick="sendMessage()">Enviar</button>
        </div>
        <p id="error" class="error"></p>
    </div>
    <script>
        async function sendMessage() {
            const input = document.getElementById("message");
            const error = document.getElementById("error");
            error.textContent = "";

            if (!input.value.trim()) {
                error.textContent = "Digite uma mensagem";
                return;
            }

            try {
                const response = await fetch("/send", {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/x-www-form-urlencoded",
                    },
                    body: `text=${encodeURIComponent(input.value)}`
                });

                const result = await response.json();
                if (!response.ok) {
                    error.textContent = result.error || "Erro ao enviar";
                } else {
                    input.value = "";
                    updateChat();
                }
            } catch (err) {
                error.textContent = "Falha na conexÃ£o";
            }
        }

        async function updateChat() {
            const response = await fetch("/messages");
            const messages = await response.json();
            const chatDiv = document.getElementById("chat");
            chatDiv.innerHTML = messages.map(msg => 
                `<div class="message"><strong>${msg.sender}:</strong> ${msg.text}</div>`
            ).join("");
            chatDiv.scrollTop = chatDiv.scrollHeight;
        }

        setInterval(updateChat, 2000);
    </script>
</body>
</html>
